(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{5685:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>h});var r=a(3365),s=a(1521),n=a(3397),o=a(8011),l=a(7265),i=a(1181),c=a(9037),d=a(8443),u=a(9395),m=a(2799);function x(e){let{onConversationUpdate:t}=e,[a,x]=(0,s.useState)(!1),[p,h]=(0,s.useState)(!1),[b,g]=(0,s.useState)(!1),[y,f]=(0,s.useState)(!1),[w,j]=(0,s.useState)(null),[v,N]=(0,s.useState)([]),[k,S]=(0,s.useState)(""),[D,A]=(0,s.useState)(""),[C,E]=(0,s.useState)(null),{startRecording:P,stopRecording:M}=function(e){let{onDataAvailable:t}=e,[a,r]=(0,s.useState)(!1),n=(0,s.useRef)(null),o=(0,s.useRef)(null),l=(0,s.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}});o.current=e;let a=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"}),s=[];a.ondataavailable=e=>{e.data.size>0&&s.push(e.data)},a.onstop=()=>{let e=new Blob(s,{type:"audio/webm"});t(e)},n.current=a,a.start(),r(!0)}catch(e){console.error("Error starting recording:",e),alert("خطا در دسترسی به میکروفون. لطفاً اجازه دسترسی را بدهید.")}},[t]),i=(0,s.useCallback)(()=>{n.current&&a&&(n.current.stop(),r(!1),o.current&&(o.current.getTracks().forEach(e=>e.stop()),o.current=null))},[a]);return{isRecording:a,startRecording:l,stopRecording:i}}({onDataAvailable:E}),{sendMessage:R,isConnected:W,connectionError:T}=function(e){let{url:t,onMessage:a,maxRetries:r=5,retryInterval:n=3e3}=e,[o,l]=(0,s.useState)(!1),[i,c]=(0,s.useState)(0),[d,u]=(0,s.useState)(null),m=(0,s.useRef)(null),x=(0,s.useRef)(),p=(0,s.useCallback)(()=>{if(t.includes("your-backend.railway.app")||i>=r){console.warn("WebSocket connection disabled: Backend not configured or max retries exceeded"),u("Backend service not available");return}try{console.log("Attempting WebSocket connection to: ".concat(t," (attempt ").concat(i+1,"/").concat(r,")"));let e=new WebSocket(t);e.onopen=()=>{console.log("WebSocket connected"),l(!0),c(0),u(null)},e.onmessage=e=>{try{let t=JSON.parse(e.data);a(t)}catch(e){console.error("Error parsing WebSocket message:",e)}},e.onclose=e=>{console.log("WebSocket disconnected",e.code,e.reason),l(!1),i<r?(c(e=>e+1),x.current=setTimeout(()=>{p()},n)):(u("Failed to connect after maximum retries"),console.error("Max WebSocket reconnection attempts exceeded"))},e.onerror=e=>{console.error("WebSocket error:",e),l(!1)},m.current=e}catch(e){console.error("Error creating WebSocket:",e),l(!1),u("Failed to create WebSocket connection")}},[t,a,i,r,n]),h=(0,s.useCallback)(e=>m.current&&m.current.readyState===WebSocket.OPEN?(m.current.send(JSON.stringify(e)),!0):(console.warn("WebSocket is not connected - message not sent"),!1),[]),b=(0,s.useCallback)(()=>{c(0),u(null),m.current&&m.current.close(),p()},[p]);return(0,s.useEffect)(()=>(p(),()=>{x.current&&clearTimeout(x.current),m.current&&m.current.close()}),[p]),{isConnected:o,sendMessage:h,connectionError:d,retryCount:i,resetConnection:b}}({url:"ws://localhost:8000",onMessage:async e=>{if("message"===e.type){S(e.user_message),A(e.bot_message),e.audio&&!y&&await O(e.audio);let a={id:Date.now(),user:e.user_message,bot:e.bot_message,timestamp:new Date,emotion:e.emotion||"neutral"};N(e=>[...e,a]),t([...v,a]),h(!1)}}});(0,s.useEffect)(()=>{C&&!a&&(_(C),E(null))},[C,a]);let U=(0,s.useCallback)(async()=>{p||(a?(await M(),x(!1),h(!0)):(w&&(w.pause(),g(!1)),await P(),x(!0)))},[a,p,P,M,w]),_=(0,s.useCallback)(async e=>{if(!W){let e=[{user:"سلام",bot:"سلام! خوش آمدید. چطور می‌تونم کمکتون کنم؟"},{user:"حالت چطوره؟",bot:"من یک ربات هوشمندم و همیشه آماده کمک به شما هستم!"},{user:"چه خبر؟",bot:"متأسفانه سرویس صوتی در دسترس نیست، اما رابط کاربری کار می‌کند."}],a=e[Math.floor(Math.random()*e.length)];S(a.user),A(a.bot);let r={id:Date.now(),user:a.user,bot:a.bot,timestamp:new Date,emotion:"neutral"};N(e=>[...e,r]),t([...v,r]);return}let a=new Uint8Array(await e.arrayBuffer());R({type:"audio",data:btoa(String.fromCharCode.apply(null,Array.from(a))),timestamp:Date.now()})||console.warn("Failed to send audio message - WebSocket not connected")},[R,W,v,t]),O=(0,s.useCallback)(async e=>{try{let t=atob(e),a=new Uint8Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);let r=new Blob([a],{type:"audio/wav"}),s=URL.createObjectURL(r),n=new Audio(s);j(n),g(!0),n.onended=()=>{g(!1),URL.revokeObjectURL(s)},n.onerror=()=>{g(!1),URL.revokeObjectURL(s)},await n.play()}catch(e){console.error("Audio playback error:",e),g(!1)}},[]);return(0,s.useEffect)(()=>{if(!b&&!p&&!a&&v.length>0){let e=setTimeout(()=>{a||p||!W||U()},1500);return()=>clearTimeout(e)}},[b,p,a,v.length,W]),(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-8 p-8",children:[(0,r.jsxs)(n.P.div,{initial:{opacity:0},animate:{opacity:1},className:"flex flex-col items-center space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2 text-sm ".concat(W?"text-green-400":"text-red-400"),children:[W?(0,r.jsx)(l.A,{size:16}):(0,r.jsx)(i.A,{size:16}),(0,r.jsx)("span",{className:"persian-text",children:W?"متصل به سرور":"قطع ارتباط"})]}),T&&(0,r.jsx)(n.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"text-xs text-yellow-400 text-center persian-text max-w-md",children:"Backend service not available"===T?"سرویس صوتی در دسترس نیست - در حالت نمایشی":"خطا در اتصال به سرور"})]}),(0,r.jsx)(o.N,{children:(k||D)&&(0,r.jsxs)(n.P.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},exit:{opacity:0,y:-30},className:"glass-effect rounded-3xl p-6 max-w-2xl w-full persian-text",children:[k&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("p",{className:"text-sm text-blue-300 mb-1",children:"شما گفتید:"}),(0,r.jsx)("p",{className:"text-white text-lg",children:k})]}),D&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-purple-300 mb-1",children:"ربات گفت:"}),(0,r.jsx)("p",{className:"text-white text-lg",children:D})]})]})}),(0,r.jsx)("div",{className:"relative",children:(0,r.jsxs)(n.P.button,{onClick:U,disabled:p,className:"relative w-32 h-32 rounded-full border-4 transition-all duration-300 ".concat(a?"bg-red-500 border-red-300 shadow-lg shadow-red-500/50":p?"bg-blue-500 border-blue-300 shadow-lg shadow-blue-500/50":b?"bg-purple-500 border-purple-300 shadow-lg shadow-purple-500/50":W?"bg-gradient-to-r from-green-500 to-emerald-500 border-green-300 hover:shadow-lg hover:shadow-green-500/50":"bg-gradient-to-r from-yellow-500 to-orange-500 border-yellow-300 hover:shadow-lg hover:shadow-yellow-500/50"),whileHover:{scale:1.05},whileTap:{scale:.95},animate:a?{scale:[1,1.1,1],transition:{duration:1,repeat:1/0}}:p?{rotate:[0,360],transition:{duration:2,repeat:1/0,ease:"linear"}}:{},children:[p?(0,r.jsx)("div",{className:"w-12 h-12 text-white mx-auto flex items-center justify-center text-2xl",children:"\uD83E\uDDE0"}):b?(0,r.jsx)(c.A,{className:"w-12 h-12 text-white mx-auto"}):a?(0,r.jsx)(d.A,{className:"w-12 h-12 text-white mx-auto"}):(0,r.jsx)(u.A,{className:"w-12 h-12 text-white mx-auto"}),(a||b)&&(0,r.jsx)(n.P.div,{className:"absolute inset-0 rounded-full border-4 ".concat(a?"border-red-400":"border-purple-400"),animate:{scale:[1,1.5,2],opacity:[1,.5,0]},transition:{duration:1.5,repeat:1/0}})]})}),(0,r.jsxs)(n.P.div,{className:"text-center",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:[(0,r.jsx)("p",{className:"text-xl font-medium ".concat(W?p?"text-blue-400":a?"text-green-400":b?"text-purple-400":"text-gray-300":"text-red-400"," persian-text"),children:W?p?"\uD83E\uDDE0 در حال پردازش...":a?"\uD83C\uDFA4 در حال ضبط صدا...":b?"\uD83D\uDD0A ربات در حال صحبت...":"\uD83D\uDC42 گوش می‌دهم... کلیک کنید":"\uD83D\uDD34 اتصال قطع شده"}),v.length>0&&(0,r.jsxs)("p",{className:"text-gray-400 mt-2 persian-text",children:["مکالمه: ",v.length," پیام"]})]}),(0,r.jsxs)(n.P.button,{onClick:()=>f(!y),className:"flex items-center space-x-2 px-4 py-2 rounded-full border ".concat(y?"bg-red-500/20 border-red-400 text-red-300":"bg-green-500/20 border-green-400 text-green-300"),whileHover:{scale:1.05},whileTap:{scale:.95},children:[y?(0,r.jsx)(m.A,{size:20}):(0,r.jsx)(c.A,{size:20}),(0,r.jsx)("span",{className:"text-sm persian-text",children:y?"صدا خاموش":"صدا روشن"})]})]})}function p(e){let{isActive:t}=e,a=Array.from({length:20},(e,t)=>t);return(0,r.jsx)("div",{className:"flex items-center justify-center space-x-1 h-20",children:a.map(e=>(0,r.jsx)(n.P.div,{className:"bg-gradient-to-t from-purple-500 to-pink-500 w-2 rounded-full",animate:t?{height:[10,60*Math.random()+20,10],opacity:[.5,1,.5]}:{height:10,opacity:.3},transition:{duration:.5+.5*Math.random(),repeat:1/0,ease:"easeInOut"}},e))})}function h(){let[e,t]=(0,s.useState)([]),[a,o]=(0,s.useState)(!1);return(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 overflow-hidden",children:(0,r.jsx)("div",{className:"absolute -inset-10 opacity-30",children:[...Array(100)].map((e,t)=>(0,r.jsx)(n.P.div,{className:"absolute rounded-full bg-white/10",style:{width:6*Math.random()+2,height:6*Math.random()+2,left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%")},animate:{y:[0,-50,0],opacity:[.2,1,.2],scale:[1,1.2,1]},transition:{duration:4*Math.random()+3,repeat:1/0,delay:3*Math.random()}},t))})}),(0,r.jsxs)("div",{className:"relative z-10 flex flex-col h-screen justify-center",children:[(0,r.jsxs)(n.P.header,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},className:"text-center mb-12",children:[(0,r.jsx)(n.P.h1,{className:"text-5xl md:text-7xl font-bold text-white mb-4 persian-text",animate:{backgroundPosition:["0%","100%"]},transition:{duration:3,repeat:1/0,ease:"linear"},style:{background:"linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7)",backgroundSize:"200% 100%",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:"\uD83D\uDDE3️ ربات گفتگوی فارسی"}),(0,r.jsx)(n.P.p,{className:"text-2xl text-purple-200 mb-2 persian-text",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:"با من صحبت کنید - فقط با صدا!"}),(0,r.jsx)("p",{className:"text-lg text-purple-300",children:"\uD83C\uDFA4 Real-time Voice • \uD83E\uDDE0 AI Persian • \uD83D\uDD0A Natural Speech"})]}),(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsx)(p,{isActive:a})}),(0,r.jsx)(x,{onConversationUpdate:e=>{t(e),o(e.length>0)}}),(0,r.jsx)(n.P.footer,{className:"text-center mt-12 text-purple-200",initial:{opacity:0},animate:{opacity:1},transition:{delay:1},children:(0,r.jsx)("p",{className:"text-sm",children:"\uD83D\uDD27 Multi-Engine STT • \uD83C\uDFAF BERT Emotion • \uD83D\uDDE3️ Natural TTS • ⚡ Real-time"})})]})]})}},6942:(e,t,a)=>{Promise.resolve().then(a.bind(a,5685))}},e=>{e.O(0,[393,347,508,358],()=>e(e.s=6942)),_N_E=e.O()}]);