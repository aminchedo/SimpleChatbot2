(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{3080:function(e,t,a){Promise.resolve().then(a.bind(a,7513))},7513:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return h}});var r=a(7821),s=a(8078),n=a(5407),i=a(3203),l=a(7256),o=a(2601),c=a(897),u=a(2780),d=a(2212),m=a(6784);function x(e){let{onConversationUpdate:t}=e,[a,x]=(0,s.useState)(!1),[p,h]=(0,s.useState)(!1),[b,g]=(0,s.useState)(!1),[f,y]=(0,s.useState)(!1),[w,j]=(0,s.useState)(null),[D,N]=(0,s.useState)([]),[v,k]=(0,s.useState)(""),[E,S]=(0,s.useState)(""),[C,A]=(0,s.useState)(null),{startRecording:R,stopRecording:M}=function(e){let{onDataAvailable:t}=e,[a,r]=(0,s.useState)(!1),n=(0,s.useRef)(null),i=(0,s.useRef)(null),l=(0,s.useCallback)(async()=>{try{let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:16e3}});i.current=e;let a=new MediaRecorder(e,{mimeType:"audio/webm;codecs=opus"}),s=[];a.ondataavailable=e=>{e.data.size>0&&s.push(e.data)},a.onstop=()=>{let e=new Blob(s,{type:"audio/webm"});t(e)},n.current=a,a.start(),r(!0)}catch(e){console.error("Error starting recording:",e),alert("خطا در دسترسی به میکروفون. لطفاً اجازه دسترسی را بدهید.")}},[t]),o=(0,s.useCallback)(()=>{n.current&&a&&(n.current.stop(),r(!1),i.current&&(i.current.getTracks().forEach(e=>e.stop()),i.current=null))},[a]);return{isRecording:a,startRecording:l,stopRecording:o}}({onDataAvailable:A}),{sendMessage:T,isConnected:U}=function(e){let{url:t,onMessage:a}=e,[r,n]=(0,s.useState)(!1),i=(0,s.useRef)(null),l=(0,s.useRef)(),o=(0,s.useCallback)(()=>{try{let e=new WebSocket(t);e.onopen=()=>{console.log("WebSocket connected"),n(!0)},e.onmessage=e=>{try{let t=JSON.parse(e.data);a(t)}catch(e){console.error("Error parsing WebSocket message:",e)}},e.onclose=()=>{console.log("WebSocket disconnected"),n(!1),l.current=setTimeout(()=>{o()},3e3)},e.onerror=e=>{console.error("WebSocket error:",e),n(!1)},i.current=e}catch(e){console.error("Error creating WebSocket:",e),n(!1)}},[t,a]),c=(0,s.useCallback)(e=>{i.current&&i.current.readyState===WebSocket.OPEN?i.current.send(JSON.stringify(e)):console.warn("WebSocket is not connected")},[]);return(0,s.useEffect)(()=>(o(),()=>{l.current&&clearTimeout(l.current),i.current&&i.current.close()}),[o]),{isConnected:r,sendMessage:c}}({url:"wss://your-backend.railway.app/ws/chat",onMessage:async e=>{if("message"===e.type){k(e.user_message),S(e.bot_message),e.audio&&!f&&await W(e.audio);let a={id:Date.now(),user:e.user_message,bot:e.bot_message,timestamp:new Date,emotion:e.emotion||"neutral"};N(e=>[...e,a]),t([...D,a]),h(!1)}}}),_=(0,s.useCallback)(async e=>{T({type:"audio",data:btoa(String.fromCharCode(...Array.from(new Uint8Array(await e.arrayBuffer())))),timestamp:Date.now()})},[T]);(0,s.useEffect)(()=>{C&&!a&&(_(C),A(null))},[C,a,_]);let O=(0,s.useCallback)(async()=>{p||(a?(await M(),x(!1),h(!0)):(w&&(w.pause(),g(!1)),await R(),x(!0)))},[a,p,R,M,w]),W=(0,s.useCallback)(async e=>{try{let t=atob(e),a=new Blob([new Uint8Array(Array.from(t).map(e=>e.charCodeAt(0)))],{type:"audio/wav"}),r=URL.createObjectURL(a),s=new Audio(r);j(s),g(!0),s.onended=()=>{g(!1),URL.revokeObjectURL(r)},s.onerror=()=>{g(!1),URL.revokeObjectURL(r)},await s.play()}catch(e){console.error("Audio playback error:",e),g(!1)}},[]);return(0,s.useEffect)(()=>{if(!b&&!p&&!a&&D.length>0){let e=setTimeout(()=>{a||p||!U||O()},1500);return()=>clearTimeout(e)}},[b,p,a,D.length,U,O]),(0,r.jsxs)("div",{className:"flex flex-col items-center space-y-8 p-8",children:[(0,r.jsxs)(n.E.div,{initial:{opacity:0},animate:{opacity:1},className:"flex items-center space-x-2 text-sm ".concat(U?"text-green-400":"text-red-400"),children:[U?(0,r.jsx)(l.Z,{size:16}):(0,r.jsx)(o.Z,{size:16}),(0,r.jsx)("span",{className:"persian-text",children:U?"متصل به سرور":"قطع ارتباط"})]}),(0,r.jsx)(i.M,{children:(v||E)&&(0,r.jsxs)(n.E.div,{initial:{opacity:0,y:30},animate:{opacity:1,y:0},exit:{opacity:0,y:-30},className:"glass-effect rounded-3xl p-6 max-w-2xl w-full persian-text",children:[v&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("p",{className:"text-sm text-blue-300 mb-1",children:"شما گفتید:"}),(0,r.jsx)("p",{className:"text-white text-lg",children:v})]}),E&&(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"text-sm text-purple-300 mb-1",children:"ربات گفت:"}),(0,r.jsx)("p",{className:"text-white text-lg",children:E})]})]})}),(0,r.jsx)("div",{className:"relative",children:(0,r.jsxs)(n.E.button,{onClick:O,disabled:!U||p,className:"relative w-32 h-32 rounded-full border-4 transition-all duration-300 ".concat(a?"bg-red-500 border-red-300 shadow-lg shadow-red-500/50":p?"bg-blue-500 border-blue-300 shadow-lg shadow-blue-500/50":b?"bg-purple-500 border-purple-300 shadow-lg shadow-purple-500/50":U?"bg-gradient-to-r from-green-500 to-emerald-500 border-green-300 hover:shadow-lg hover:shadow-green-500/50":"bg-gray-500 border-gray-400 cursor-not-allowed"),whileHover:U?{scale:1.05}:{},whileTap:U?{scale:.95}:{},animate:a?{scale:[1,1.1,1],transition:{duration:1,repeat:1/0}}:p?{rotate:[0,360],transition:{duration:2,repeat:1/0,ease:"linear"}}:{},children:[p?(0,r.jsx)("div",{className:"w-12 h-12 text-white mx-auto flex items-center justify-center text-2xl",children:"\uD83E\uDDE0"}):b?(0,r.jsx)(c.Z,{className:"w-12 h-12 text-white mx-auto"}):a?(0,r.jsx)(u.Z,{className:"w-12 h-12 text-white mx-auto"}):(0,r.jsx)(d.Z,{className:"w-12 h-12 text-white mx-auto"}),(a||b)&&(0,r.jsx)(n.E.div,{className:"absolute inset-0 rounded-full border-4 ".concat(a?"border-red-400":"border-purple-400"),animate:{scale:[1,1.5,2],opacity:[1,.5,0]},transition:{duration:1.5,repeat:1/0}})]})}),(0,r.jsxs)(n.E.div,{className:"text-center",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:[(0,r.jsx)("p",{className:"text-xl font-medium ".concat(U?p?"text-blue-400":a?"text-green-400":b?"text-purple-400":"text-gray-300":"text-red-400"," persian-text"),children:U?p?"\uD83E\uDDE0 در حال پردازش...":a?"\uD83C\uDFA4 در حال ضبط صدا...":b?"\uD83D\uDD0A ربات در حال صحبت...":"\uD83D\uDC42 گوش می‌دهم... کلیک کنید":"\uD83D\uDD34 اتصال قطع شده"}),D.length>0&&(0,r.jsxs)("p",{className:"text-gray-400 mt-2 persian-text",children:["مکالمه: ",D.length," پیام"]})]}),(0,r.jsxs)(n.E.button,{onClick:()=>y(!f),className:"flex items-center space-x-2 px-4 py-2 rounded-full border ".concat(f?"bg-red-500/20 border-red-400 text-red-300":"bg-green-500/20 border-green-400 text-green-300"),whileHover:{scale:1.05},whileTap:{scale:.95},children:[f?(0,r.jsx)(m.Z,{size:20}):(0,r.jsx)(c.Z,{size:20}),(0,r.jsx)("span",{className:"text-sm persian-text",children:f?"صدا خاموش":"صدا روشن"})]})]})}function p(e){let{isActive:t}=e,a=Array.from({length:20},(e,t)=>t);return(0,r.jsx)("div",{className:"flex items-center justify-center space-x-1 h-20",children:a.map(e=>(0,r.jsx)(n.E.div,{className:"bg-gradient-to-t from-purple-500 to-pink-500 w-2 rounded-full",animate:t?{height:[10,60*Math.random()+20,10],opacity:[.5,1,.5]}:{height:10,opacity:.3},transition:{duration:.5+.5*Math.random(),repeat:1/0,ease:"easeInOut"}},e))})}function h(){let[e,t]=(0,s.useState)([]),[a,i]=(0,s.useState)(!1);return(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-900 relative overflow-hidden",children:[(0,r.jsx)("div",{className:"absolute inset-0 overflow-hidden",children:(0,r.jsx)("div",{className:"absolute -inset-10 opacity-30",children:[...Array(100)].map((e,t)=>(0,r.jsx)(n.E.div,{className:"absolute rounded-full bg-white/10",style:{width:6*Math.random()+2,height:6*Math.random()+2,left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%")},animate:{y:[0,-50,0],opacity:[.2,1,.2],scale:[1,1.2,1]},transition:{duration:4*Math.random()+3,repeat:1/0,delay:3*Math.random()}},t))})}),(0,r.jsxs)("div",{className:"relative z-10 flex flex-col h-screen justify-center",children:[(0,r.jsxs)(n.E.header,{initial:{y:-50,opacity:0},animate:{y:0,opacity:1},className:"text-center mb-12",children:[(0,r.jsx)(n.E.h1,{className:"text-5xl md:text-7xl font-bold text-white mb-4 persian-text",animate:{backgroundPosition:["0%","100%"]},transition:{duration:3,repeat:1/0,ease:"linear"},style:{background:"linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #ffeaa7)",backgroundSize:"200% 100%",backgroundClip:"text",WebkitBackgroundClip:"text",color:"transparent"},children:"\uD83D\uDDE3️ ربات گفتگوی فارسی"}),(0,r.jsx)(n.E.p,{className:"text-2xl text-purple-200 mb-2 persian-text",animate:{opacity:[.7,1,.7]},transition:{duration:2,repeat:1/0},children:"با من صحبت کنید - فقط با صدا!"}),(0,r.jsx)("p",{className:"text-lg text-purple-300",children:"\uD83C\uDFA4 Real-time Voice • \uD83E\uDDE0 AI Persian • \uD83D\uDD0A Natural Speech"})]}),(0,r.jsx)("div",{className:"mb-8",children:(0,r.jsx)(p,{isActive:a})}),(0,r.jsx)(x,{onConversationUpdate:e=>{t(e),i(e.length>0)}}),(0,r.jsx)("div",{className:"hidden",children:e.length}),(0,r.jsx)(n.E.footer,{className:"text-center mt-12 text-purple-200",initial:{opacity:0},animate:{opacity:1},transition:{delay:1},children:(0,r.jsx)("p",{className:"text-sm",children:"\uD83D\uDD27 Multi-Engine STT • \uD83C\uDFAF BERT Emotion • \uD83D\uDDE3️ Natural TTS • ⚡ Real-time"})})]})]})}}},function(e){e.O(0,[295,115,364,744],function(){return e(e.s=3080)}),_N_E=e.O()}]);